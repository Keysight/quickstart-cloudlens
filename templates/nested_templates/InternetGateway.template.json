{
    "AWSTemplateFormatVersion":"2010-09-09",
    "Description":"Template to create IGW in a specified VPC and add subnet to access internet gateway: Version 0.1",
    "Parameters":{
        "VPC":{
            "Description":"VPC Id is required to create an IGW",
            "Type":"AWS::EC2::VPC::Id"
        },
        "PrimaryManagementSubnetId":{
            "Description":"Primary Public Subnet required to create IGW for external communication",
            "Type":"AWS::EC2::Subnet::Id"
        },
        "SecondaryManagementSubnetId":{
            "Description":"Secondary Public Subnet required to create IGW for external communication",
            "Type":"AWS::EC2::Subnet::Id"
        }
    },
    "Resources":{
        "InternetGateway":{
            "Type":"AWS::EC2::InternetGateway",
            "Properties":{
                "Tags":[{
                        "Key":"Application",
                        "Value":{
                            "Ref":"AWS::StackName"
                        }
                    },{
                        "Key":"Network",
                        "Value":"Public"
                    }]
            }
        },
        "AttachGateway":{
            "Type":"AWS::EC2::VPCGatewayAttachment",
            "Properties":{
                "VpcId":{
                    "Ref":"VPC"
                },
                "InternetGatewayId":{
                    "Ref":"InternetGateway"
                }
            },
            "DependsOn":"InternetGateway"
        },
        "PublicRouteTable":{
            "Type":"AWS::EC2::RouteTable",
            "Properties":{
                "VpcId":{
                    "Ref":"VPC"
                },
                "Tags":[{
                        "Key":"Application",
                        "Value":{
                            "Ref":"AWS::StackName"
                        }
                    },{
                        "Key":"Network",
                        "Value":"Public"
                    }]
            },
            "DependsOn":"AttachGateway"
        },
        "PublicRoute":{
            "Type":"AWS::EC2::Route",
            "Properties":{
                "RouteTableId":{
                    "Ref":"PublicRouteTable"
                },
                "DestinationCidrBlock":"0.0.0.0/0",
                "GatewayId":{
                    "Ref":"InternetGateway"
                }
            }
        },
        "PrimaryPublicSubnetRouteTableAssociation":{
            "Type":"AWS::EC2::SubnetRouteTableAssociation",
            "Properties":{
                "SubnetId":{
                    "Ref":"PrimaryManagementSubnetId"
                },
                "RouteTableId":{
                    "Ref":"PublicRouteTable"
                }
            },
            "DependsOn":"PublicRoute"
        },
        "SecondaryPublicSubnetRouteTableAssociation":{
            "Type":"AWS::EC2::SubnetRouteTableAssociation",
            "Properties":{
                "SubnetId":{
                    "Ref":"SecondaryManagementSubnetId"
                },
                "RouteTableId":{
                    "Ref":"PublicRouteTable"
                }
            },
            "DependsOn":"PublicRoute"
        },
        "PublicNetworkAcl":{
            "Type":"AWS::EC2::NetworkAcl",
            "Properties":{
                "VpcId":{
                    "Ref":"VPC"
                },
                "Tags":[{
                        "Key":"Application",
                        "Value":{
                            "Ref":"AWS::StackName"
                        }
                    },{
                        "Key":"Network",
                        "Value":"Public"
                    }]
            }
        }
    }
}
